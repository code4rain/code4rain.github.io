<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    Change Outlook Subject with Python &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Life Log</h1>
        <p class="lead">Alex Kyoungdon Jang`s life log</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="https://github.com/mdo/hyde/archive/v1.1.1.zip">Download</a>
            </li>
            <li>
              <a href="https://github.com/mdo/hyde">GitHub project</a>
            </li>
            <li>Currently v1.1.1</li>
          </ul>
          <p>&copy; 2014.  All rights reserved.</p>
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Change Outlook Subject with Python</h1>
  <span class="post-date">27 Dec 2012</span>
  <h2>동기</h2>

<p>아웃룩의 제목에 Re: Fwd: 등의 문자열이 들어가서 제목을 한 눈에 알아볼 수가 없어서 찾기 시작</p>

<h2>Reference</h2>

<p>Stack Overflow:<br/>
<em><a href="http://stackoverflow.com/questions/1440233/possible-to-intercept-and-rewrite-email-on-outlook-client-side-using-ironpython">http://stackoverflow.com/questions/1440233/possible-to-intercept-and-rewrite-email-on-outlook-client-side-using-ironpython</a></em></p>

<h2>설치 방법</h2>

<ol>
<li>Download and install <a href="http://sourceforge.net/projects/pywin32/">pywin32</a>

<ul>
<li>python은 가자 많이 사용하는 2.7.3 버전 설치(windows용) - <a href="http://www.python.org/getit/">Download</a></li>
<li>pywin32는 버전에 맞는 library설치 (여기서는 pywin32-218.win32-py2.7.exe 설치) - <a href="http://sourceforge.net/projects/pywin32/files/pywin32/Build%20218/">Download</a></li>
</ul>
</li>
<li>아래와 같이 test script 작성(save as test.py)</li>
</ol>


<pre><code class="python">import os, sys, re
import win32com.client
#session = win32com.client.gencache.EnsureDispatch("MAPI.session")
win32com.client.gencache.EnsureDispatch("Outlook.Application")
outlook = win32com.client.Dispatch("Outlook.Application")
#print '\n'.join(dir(outlook))
mapi = outlook.GetNamespace('MAPI')
inbox =  mapi.GetDefaultFolder(win32com.client.constants.olFolderInbox)
items = inbox.Items
#items.Restrict("[Unread] = true")
#print '\n'.join(dir(items))
#print "hello"
    while True:
    item = items.GetNext()
    if item == None: break
        #print '\n'.join(dir(item))

        if re.compile(r'Fwd\[*\d*\]*: |FW\[*\d*\]*: |Re\[*\d*\]*: |RE\[*\d*\]*: ').search(item.Subject):
        # print item.Subject.encode('euc-kr')
        # print item.Body
        # works VVVV
        # item.Body = 'whoya!'
        item.Subject = re.sub(r'Fwd\[*\d*\]*: |FW\[*\d*\]*: |Re\[*\d*\]*: |RE\[*\d*\]*: ','', item.Subject)
        item.Save()
        # print item.Subject.encode('euc-kr')
        # break
</code></pre>

<ol>
<li>원하는 문자열로 바꾸고 싶다면 re.compile, re.sub 뒤에 오는 regular expression을 수정하면됨.</li>
</ol>


<h2>2013-01-10 Update.</h2>

<p>기존 version의 경우 default Inbox에서만 검색해서 Subject를 수정함.
Recursive로 하위 폴더에 대해서도 Subject를 수정하도록 변경함.
``` python
import os, sys, re
import win32com.client
from win32com.client import Dispatch, constants</p>

<p>def parse_folder(folder):
    print folder.Name.encode('euc-kr')
    items = folder.Items
    while True:
        item = items.GetNext()
        if item == None: break
        #print '\n'.join(dir(item))</p>

<pre><code>    if re.compile(r'Fwd\[*\d*\]*: |FW\[*\d*\]*: |Re\[*\d*\]*: |RE\[*\d*\]*: |Fwd\d*: |Re\d* :|Fwd\(*\d*\)*: |Re\(*\d*\)*: |Re:\(*\d*\)* |RE\**\d*: |Fwd:\(*\d*\)* ').search(item.Subject):
        # print item.Subject
        print item.Subject.encode('euc-kr')
        # print item.Body
        # works VVVV
        # item.Body = 'whoya!'
        item.Subject = re.sub(r'Fwd\[*\d*\]*: |FW\[*\d*\]*: |Re\[*\d*\]*: |RE\[*\d*\]*: |Fwd\d*: |Re\d* :|Fwd\(*\d*\)*: |Re\(*\d*\)*: |Re:\(*\d*\)* |RE\**\d*: |Fwd:\(*\d*\)* ','', item.Subject)
        item.Save()
        # print item.Subject.encode('euc-kr')
        # break
for i in range(1, folder.Folders.Count + 1):
    parse_folder(folder.Folders[i])
</code></pre>

<p>win32com.client.gencache.EnsureDispatch("Outlook.Application")
outlook = win32com.client.Dispatch("Outlook.Application")
mapi = outlook.GetNamespace('MAPI')
inbox =  mapi.GetDefaultFolder(win32com.client.constants.olFolderInbox)
items = inbox.Items
parse_folder(inbox)
```</p>

<h2>TODO more</h2>

<p>위 방법을 사용하더라도 conversation view(대화 형식 보기)에서는 Re: Fwd:가 남아있음.<br/>
MSDN을 찾아보니 conversation view에서는 ConversationTopic을 Subject로 사용하고, ConversationTopic은 Readonly attribute을 가지고 있어 수정이 안됨.<a href="http://msdn.microsoft.com/en-us/library/office/ff869318.aspx">MSDN LINK</a><br/>
임시로 Conversation View를 Off하고 보는 중</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2014/03/09/ssh-rogeuinsi-jeobsogjiyeon-haegyeolbangbeob/">
            SSH 로그인시 접속지연 해결방법
            <small>09 Mar 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/tip/git/2012/12/14/pushdoen-commitnaeyong-sujeonghagi-gerrit-reviewjeon/">
            PUSH된 COMMIT내용 수정하기(Gerrit Review전)
            <small>14 Dec 2012</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/vim/2012/12/13/gvim-gibon-sijag-wici-byeongyeong/">
            Gvim 기본 시작 위치 변경
            <small>13 Dec 2012</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
